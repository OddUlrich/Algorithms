# YOLOv3 目标检测

YOLO 自诞生以来，就有两个特点被广泛承认：

* 速度快
* 不擅长检测小物体

YOLO 第一版发布时惊为天人，第二代增加输出类别，名为 YOLO9000。但由于原理上的限制，YOLO 仅检测最后一层卷积输出层，小物体像素少，经过层层卷积，在这一层上的信息几乎体现不出来，导致难以识别。

YOLOv3经过改良后（An Incremental Improvement），通过多级检测等方法，提升了预测的准确率。



## 设计理念

相比于滑动窗口技术，YOLO直接将原始图片分割成互不重合的小方块，然后通过卷积最后生产不同大小的特征图。可以认为特征图的每个元素也是对应原始图片的一个小方块，然后可以用每个元素来预测那些中心点在该小方格内的目标，这就是 YOLO 算法的朴素思想。

具体来讲，YOLO 的 CNN 网络将图片分割成网格，然后每个单元格负责去检测那些中心点落在该各自内的目标。每个单元格会预测 B 个边界框（bounding box），以及边界框的置信度（confidence score）。其实置信度包含两个方面，一方面指的是这个边界框含有目标的可能性大小；另一方面代表这个边界框的准确度，该准确度可以用预测框与实际框（ground truth）的交并比 IoU （Intersection over Union）来表征。所以置信度常表示为两者之和。

边界框的大小和位置用 4 个值来表征：（x，y，w，h）。其中（x，y）是边界框的中心坐标，w 和 h 是边界框的宽和高。需要注意的是，中心坐标的预测值（x，y）是相对于每个单元格左上角坐标点的偏移值，并且单位是相对于单元格大小的；而边界框的 w 和 h 预测值是相对于整个图片的宽与高的比例，这样理论上4个元素的大小应该在 [0, 1] 范围内。

在分类问题中，对于每一个单元格，其还要给出预测出每个类别概率值，其表征的是由该单元格负责预测的边界框其目标属于各个类别的概率，但是这些概率值其实是在各个边界框置信度下的条件概率 。值得注意的是，不管一个单元格预测多少个边界框，其只预测一组类别概率值，这是 YOLO 算法的一个缺点，在后来的改进版本中，YOLO9000 是把类别概率预测值与边界框是绑定在一起的。

边界框类别置信度表征的是该边界框中目标属于各个类别的可能性大小以及边界框匹配目标的好坏。一般会根据类别置信度来过滤网络的预测框。





## 网络预测

在 YOLO 算法的预测过程中，会采用倒非极大值抑制算法（non maximum suppression, NMS）。这个算法不单单是针对 YOLO 算法的，而是所有的检测算法中都会用到。NMS算法主要解决的是一个目标被多次检测的问题，我们希望最后仅仅输出其中一个最好的预测框，那么可以采用NMS算法来实现这样的效果：首先从所有的检测框中找到置信度最大的那个框，然后挨个计算其与剩余框的 IoU，如果其值大于一定阈值（重合度过高），那么就将该框剔除；然后对剩余的检测框重复上述过程，直到处理完所有的检测框。