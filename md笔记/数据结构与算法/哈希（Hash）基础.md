# 哈希（Hash）基础

哈希表，也称散列表。散列表是普通数组概念的推广，因为数组可以通过直接选址访问数组内的任意元素。如果空间允许，我们就可以使用一个数组为每一个可能的关键字保留一个位置。但如果实际存储的关键字数目比较多时，使用散列表则更为有效，因为散列表会根据关键字计算出下标，从而获取关键字的存储地址。



哈希表的大小（长度）通常会取一个值为 **4k+3 的质数**，其中 k 为整数。



## 装载因子

给定一个能存放 n 个元素的、具有 m 个槽位的散列表，定义该散列表的装载因子 a = n / m，即一个联众平均存储的元素数：装载因子（负载因子） = 装入的元素个数 / 哈希表的长度

取值为 1 说明装入的元素个数与表长相等，再添加元素时不一定会出现冲突

若采用链地址处理，则向哈希表中散列元素时不一定会产生冲突。



## 直接寻址表

当关键字的全域比较小时，直接寻址是一种简单而有效的技术。但这个并不算是哈希的构建方法，其实就是我们平常使用的数组，通过索引直接可以获取到对应元素的存储地址，进而对该元素进行访问。

直接定址法存在两个明显的问题。一是如果关键字集合非常大，在计算机可用容量有限的情况下，维护一个如此大的内存空间是非常不现实的。二是如果实际存储的关键字数目相对于所分配的内存空间而言非常小，那么绝大多数空间都要被浪费掉。

因此，我们常常会使用一些合适的映射方法，将关键字映射到散列表的空位中，从而集中充分利用系统分配的内存空间。这样的映射过程常常被称为**散列函数**（或者**哈希函数**）。

在映射的过程中，有可能不同的关键字会映射到同一个值，这种情况我们称之为**碰撞**或者**冲突**。同样的，我们根据实际情况，选用不同的方法来解决冲突。





## 哈希构建方法

多数散列函数都假定关键字为自然数。如果所给的关键字不为自然数，则我们必须要用一种方法将他们解释为自然数。例如一个字符串关键字的字符可以用其 ASCII 码表示，通过乘以某个特定基数后相加，得到一个自然数作为标识。



### 除留余数法

又称除法散列法，通过取 k 除以 m 的余数，将关键字 k 映射到散列表 m 个槽的某一个去，即 h(k) = k mod m。

使用除留余数法的一个经验是，通常 m 的选择会考虑以下情况：

* 不能为 2 的幂。
* 常常选择与 2 的整数幂不太接近的质数。
* 与装载因子 a 比较接近的值。
* 小于或等于表长（最好接近 m）的**最小质数**或**不包含小于20质因子的合数**。



### 数字分析法





### 平方取中法





### 分段叠加法









## 哈希冲突的处理方法





### 链地址法/链接发

链地址法的基本思想是，把散列到同一槽中的所有元素都放在一个链表中。也就是一旦发生冲突，在当前位置给单链表增加结点。











### 开放定址法/开放寻址法（闭哈希表）

主要思想是，当要插入一个元素时，可以连续第检查或者探查散列表的各项，直到找到一个空槽来防止待插入的关键字时为止。也就是一旦发生冲突，就去寻找下一个空的散列地址，只要散列地址够大，空的地址总会找到。

查找与插入的算法过程基本相同，但删除操作执行起来就比较困难，因为当我们删除某个关键字的时候，如果把它直接删去置为空，那么那些由于该关键字占领了槽位而向后面继续探查位置才成功插入的关键字，就无法被检索到了。因此，对于使用开放定址法的散列表，在执行删除操作时，会**把被删除的关键字置成一个特定的标识值**。由于这个原因，在必须删除关键字的应用中，往往采用**链接法**来解决碰撞。



#### 线性探测法

线性探查采用的散列函数为
$$
h(k, i) = (h'(k) + i) \quad mod \quad m, \quad i = 0, 1, ... , m - 1
$$
给定一个关键字 k，按照散列函数对相应的槽进行探查，若该槽已经被占据，则顺次探查下一个槽，直至找到空槽为止。这种线性探查方法比较容易实现，但它存在**一次群集**的问题，随着时间推移，连续被占用的槽不断增加，平均查找时间也随着不断增加。



#### 二次探查/线性补偿探测法

$$
h(k, i) = (h'(k) + c_1 i + c_2 i^2) \quad mod \quad m, \quad i = 0, 1, ... , m - 1
$$

与线性探测法相比，增加了 $c_1$ 和 $c_2$ 两个辅助常数，依赖于 i 增加了偏移量。这个方法会导致一种程度减轻的群集现象，称为二次群集。



#### 再散列法





#### 随机探测法

#### 伪随机探测法



#### 二次探测法（平方探测法）

二次探测法会对经过哈希函数处理后的冲突结果进行二次探测，对于单个关键字的探测过程来说，会依次对散列后的结果进行一下处理：

> +1$^2$, -1$^2$, +2$^2$, -2$^2$,+3$^2$, -3$^2$, ... , +[(m-1)/2]$^2$,  -[(m-1)/2]$^2$.



### 拉链法（开哈希表）







### 建立公共溢出区













