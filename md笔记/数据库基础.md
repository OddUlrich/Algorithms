# 数据库基础



数据库管理技术的三个阶段是人工管理阶段、文件系统阶段和数据库系统阶段。人工管理阶段没有专门的软件对数据进行管理。文件系统阶段,这一阶段的主要标志是计算机中有了专门管理数据库的软件——操作系统（文件管理）。 



## 模型

常用的数据模型：概念模型、逻辑模型、物理模型

常用的逻辑模型：层次模型、网状模型、关系模型



关系数据模型的逻辑结构是关系

层次数据模型的逻辑结构是树

网状数据结构的逻辑结构是图



层次模型采用树型结构表示数据与数据间的联系。在层次模型中，每一个节点表示记录类型(实体)，记录之间的联系用节点之间的连线表示，并且根节点以外的其他节点有且仅有一个双亲节点。层次模型不能直接表示多对多联系，若要表示多对多的联系，可采用如下两种方法： 
・ 冗余节点法――两个实体的多对多的联系转换为两个一对多的联系，该方法的优点是节点清晰，允许节点改变存储位置，缺点是需要额外的存储空间，有潜在的数据不一致性。 
・ 虚拟节点分解法――将冗余节点转换为虚拟节点，虚拟节点是一个指引元，指向所代替的节点，该方法的优点是减少对存储空间的浪费，避免数据不一致性，缺点是改变存储位置可能引起虚拟节点中指针的修改。



## 模式结构





数据库领域公认的标准结构是三级模式结构，它包括外模式、概念模式、内模式，有效地组织、管理数据，提高了数据库的逻辑独立性和物理独立性。用户级对应外模式，概念级对应概念模式，物理级对应内模式，使不同级别的用户对数据库形成不同的视图。

外模式又称子模式或用户模式，对应于用户级。它是某个或某几个用户所看到的数据库的数据视图，是与某一应用有关的数据的逻辑表示 。

模式又称概念模式或逻辑模式，对应于概念级。它是由数据库设计者综合所有用户的数据，**按照统一的观点构造的全局逻辑结构，是对数据库中全部数据的逻辑结构和特征的总体描述**，是所有用户的公共数据视图(全局视图)。

内模式又称存储模式，对应于物理级，它是数据库中全体数据的内部表示或底层描述，是数据库最低一级的逻辑描述，它描述了数据在存储介质上的存储方式和物理结构，对应着实际存储在外存储介质上的数据库。



SQL是高级的非过程化编程语言，它允许用户在高层数据结构上工作



## 数据完整性

实体完整性，确保不出现完全相同的数据记录

区域完整性， 通过限制数据类型，检查约束，输入格式，外键约束，默认值，非空等体现

参考完整性，避免因一个数据表的记录改变而造成相关数据表内的数据变成无效值。

用户自定义完整性，用户自定义由用户根据实际应用中的需要自行定义。

题意为检查约束，属于域完整性，无选项。。因此选择用户自定义



(1) 实体完整性：指表中行的完整性。主要用于保证操作的数据(记录)非空、唯一且不重复。

(2) 域完整性： 是指数据库表中的列必须满足某种特定的数据类型或约束。其中约束又包括取值范围、精度等规定。表中的CHECK、FOREIGN KEY 约束和DEFAULT、 NOT NULL定义都属于域完整性的范畴。

(3)参照完整性： 属于表间规则。



外键约束

唯一性约束

检查约束（通常是检查一个数据是否在合法的取值范围内）



## 索引

MySQL 常见索引和使用场景

索引的优缺点

如何设置索引

1、  表的某个字段值得离散度越高，该字段越适合选作索引的关键字。主键字段以及唯一性约束字段适合选作索引的关键字，原因就是这些字段的值非常离散。尤其是在主键字段创建索引时， cardinality （基数，集的势）的值就等于该表的行数。 MySQL 在处理主键约束以及唯一性约束时，考虑周全。数据库用户创建主键约束的同时， MySQL 自动创建主索引（ primary index ），且索引名称为 Primary ；数据库用户创建唯一性索引时， MySQL 自动创建唯一性索引（ unique index ），默认情况下，索引名为唯一性索引的字段名。

2、  占用存储空间少的字段更适合选作索引的关键字。例如，与字符串相比，整数字段占用的存储空间较少，因此，较为适合选作索引关键字。

3、  存储空间固定的字段更适合选作索引的关键字。与 text 类型的字段相比， char 类型的字段较为适合选作索引关键字。

4、  Where 子句中经常使用的字段应该创建索引，分组字段或者排序字段应该创建索引，两个表的连接字段应该创建索引。

5、  更新频繁的字段不适合创建索引，不会出现在 where 子句中的字段不应该创建索引。

6、  最左前缀原则。

7、  尽量使用前缀索引。





## 锁



共享（S)锁：多个事务可封锁一个共享页；任何事务都不能修改该页； 通常是该页被读取完毕，S锁立即被释放。 

排它（X)锁：仅允许一个事务封锁此页；其他任何事务必须等到X锁被释放才能对该页进行访问；X锁一直到事务结束才能被释放。

更新（U)锁：用来预定要对此页施加X锁，它允许其他事务读，但不允许再施加U锁或X锁；当被读取的页将要被更新时，则升级为X锁；U锁一直到事务结束时才能被释放。





* 脏读
* 不可重复读
* 幻读



## 数据库复制

Mysql 复制分成三步：
(1)   master将改变记录到二进制日志(binary log)中（这些记录叫做二进制日志事件，binary log events）；
(2)   slave将master的binary log events拷贝到它的中继日志(relay log)；

(3)   slave重做中继日志中的事件，将改变反映它自己的数据。



## B树 v.s B+ 树

MongoDB 用 B 树；Mysql 用 B+ 树。



B 树和 B+ 树显著不同的地方是：

- B 树非叶子节点即是索引，也是数据；B+ 树非叶子节点仅是索引，数据全部存储在叶子节点。
- B+ 树叶子节点的数据之间是用链表链接的。



**B+树相比B树：**

* 数据的连续性：B+ 树叶子节点上一页存储的数据是连续的，当需要一个节点上的数据时，B+ 树可以增大缓存的命中率。
* 叶子节点之间的连接性：当作范围或全文扫描时，B+ 树可以依赖叶子节点做线性顺序扫描，而 B 树只能在每一层的节点上做扫描。B+ 树同样可以增大缓存的命中率。

**B 树相比 B+ 树：**当作单一数据查询时，B 树的节点平均离根节点更近，平均查询效率比 B+ 树快。



总结一下就是，B+ 树相比 B 树，前者更适合范围查询，后者更适合单一数据查询。

**MongoDB** 是非关系型数据库，数据之间的关系用嵌套解决。它的主要使用场景是：追求单个读写记录的性能。

**Mysql** 是关系型数据库，数据之间的关系用共同的索引键，Join 解决。它的使用场景：不仅存在大量的单一数据查询，也存在大量的范围查询。



## 事务的 ACID



